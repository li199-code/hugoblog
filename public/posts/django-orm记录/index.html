<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.119.0">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Django ORM记录 &middot; JasonLee</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://blog.jasonleehere.com/"><h1>JasonLee</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="http://blog.jasonleehere.com/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2023. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Django ORM记录</h1>
  <time datetime=2022-11-24T11:22:00Z class="post-date">Thu, Nov 24, 2022</time>
  <p>记录曾经不懂的问题和踩过的坑</p>
<!-- raw HTML omitted -->
<h2 id="choices">choices</h2>
<p>Django 模型中的字段有个 choices 属性，这个属性可以提供被选数据。如果一个字段设置了这个属性,在模版中如果我要显示这个字段，那么 django 模版系统就会将它默认解析为一个下拉菜单。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e"># models.py</span>
</span></span><span style="display:flex;"><span>choices <span style="color:#f92672">=</span> (
</span></span><span style="display:flex;"><span>		(<span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;男&#39;</span>), (<span style="color:#ae81ff">2</span>, <span style="color:#e6db74">&#39;女&#39;</span>), (<span style="color:#ae81ff">3</span>, <span style="color:#e6db74">&#39;其他&#39;</span>)
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>gender <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>IntegerField(choices<span style="color:#f92672">=</span>choices)
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># html {{ obj.get_gender_display }}
</span></span><span style="display:flex;"><span>##在模板中，为了获取元组中id对应值，用左边的语法
</span></span></code></pre></div><h2 id="外键">外键</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">#model.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 外键要关联的表</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">department</span>(models<span style="color:#f92672">.</span>Model):
</span></span><span style="display:flex;"><span>	name <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>CharField(max_length<span style="color:#f92672">=</span><span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">## 在结合modelForm时，若for循环输出，下面语句可避免bug</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">def</span> __str__(self):
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>name
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>department <span style="color:#f92672">=</span> models<span style="color:#f92672">.</span>ForeignKey(to<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;department&#39;</span>, on_delete<span style="color:#f92672">=</span>models<span style="color:#f92672">.</span>CASCADE)
</span></span><span style="display:flex;"><span><span style="color:#75715e">## 外键关联上后，执行迁移，会在本表创建一个名为&#39;department_id&#39;字段。</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span># html {{ obj.department.name }} ##department字段会返回一个department表的对象
</span></span></code></pre></div><h2 id="modelform">modelForm</h2>
<h3 id="添加数据">添加数据</h3>
<p>当想让用户向已有数据库中添加新的数据，应该用 modelForm 来创建一个对象。这个对象可以用 for 循环来在模板中显示字段，而且具有自动对数据进行校验和报错功能。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">## views.py</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">employModelForm</span>(forms<span style="color:#f92672">.</span>ModelForm):
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">## 默认校验非空，可以对数据进行个性化校验，如：</span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">## password = forms.CharField(min_length=3, label=&#39;密码&#39;)</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Meta</span>:
</span></span><span style="display:flex;"><span>		model <span style="color:#f92672">=</span> employee
</span></span><span style="display:flex;"><span>		fields <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;__all__&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">add</span>(req):
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> req<span style="color:#f92672">.</span>method <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;GET&#39;</span>:
</span></span><span style="display:flex;"><span>		<span style="color:#75715e"># form = employeeForm()</span>
</span></span><span style="display:flex;"><span>		form <span style="color:#f92672">=</span> employModelForm()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> render(req, <span style="color:#e6db74">&#39;emp_add.html&#39;</span>, {<span style="color:#e6db74">&#39;form&#39;</span>: form})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	form <span style="color:#f92672">=</span> employModelForm(data<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span>POST)
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">if</span> form<span style="color:#f92672">.</span>is_valid():
</span></span><span style="display:flex;"><span>		form<span style="color:#f92672">.</span>save()
</span></span><span style="display:flex;"><span>		<span style="color:#66d9ef">return</span> redirect(<span style="color:#e6db74">&#39;/emp/list/&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>	<span style="color:#75715e">## 数据校验失败，将已输入的信息和产生的错误提示返回给页面</span>
</span></span><span style="display:flex;"><span>	<span style="color:#66d9ef">return</span> render(req, <span style="color:#e6db74">&#39;emp_add.html&#39;</span>, {<span style="color:#e6db74">&#39;form&#39;</span>: form})
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>{{field.label}}: {{ field }} {{ field.errors.0 }} //错误信息输出
</span></span></code></pre></div><h3 id="修改数据">修改数据</h3>
<p>修改数据时，要告诉 django 修改的对象是哪个。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#75715e">## views.py</span>
</span></span><span style="display:flex;"><span>form <span style="color:#f92672">=</span> employModelForm(data<span style="color:#f92672">=</span>req<span style="color:#f92672">.</span>POST, instance<span style="color:#f92672">=</span>obj)
</span></span></code></pre></div>
</div>


    </main>

    
      
    
  </body>
</html>
