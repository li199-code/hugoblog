<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="zh-CN" lang="zh-CN">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.119.0">

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>跨域问题描述和解决方案 &middot; JasonLee</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://blog.jasonleehere.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://blog.jasonleehere.com/"><h1>JasonLee</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="http://blog.jasonleehere.com/">Home</a> </li>
        
      </ul>
    </nav>

    <p>&copy; 2023. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>跨域问题描述和解决方案</h1>
  <time datetime=2022-08-17T17:24:13Z class="post-date">Wed, Aug 17, 2022</time>
  <h3 id="什么是跨域">什么是跨域</h3>
<p>跨域是浏览器对js脚本和ajax请求做出的限制。不同源的js脚本获取对方的cookie，ajax无法发送跨域请求。</p>
<h3 id="解决方案">解决方案</h3>
<h4 id="cors">CORS</h4>
<p>在服务器设置字段<code>Access-Control-Allow-Origin</code>。当浏览器收到服务器返回的资源上，没有<code>Access-Control-Allow-Origin</code>字段,就会拒绝加载</p>
<h4 id="jsonp">jsonp</h4>
<p>jsonp的原理就是利用<code>&lt;script&gt;</code>标签没有跨域限制，通过<code>&lt;script&gt;</code>标签src属性，发送带有callback参数的GET请求，服务端将接口返回数据拼凑到callback函数中，返回给浏览器，浏览器解析执行，从而前端拿到callback函数返回的数据。</p>
<p>问题描述：调试阶段，前端项目请求后端接口返回数据，前端项目和后端的端口不一致，产生了跨域问题。部署阶段，前端打包完毕，项目发起请求，同样有跨域问题，两种场景的解决方法不同。</p>
<p>下面解决问题的场景是，打包的前端文件并不在服务器的文件路径中。</p>
<!-- raw HTML omitted -->
<h3 id="调试阶段">调试阶段</h3>
<p>后端可以不用设置，只要前端设置代理服务器即可。在vue根目录下的<code>vue.config.js</code>添加下述代码：</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">module</span>.<span style="color:#a6e22e">exports</span> <span style="color:#f92672">=</span> ({
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">devServer</span><span style="color:#f92672">:</span> {
</span></span><span style="display:flex;"><span>		<span style="color:#a6e22e">proxy</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;http://localhost:3000&#39;</span> <span style="color:#75715e">//3000为后端接口的端口号
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>	},
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">publicPath</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;./&#39;</span> <span style="color:#75715e">//解决打包后的静态文件路径问题
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>})
</span></span></code></pre></div><p>跨域只存在浏览器中，服务器之间不存在跨域，所以可以通过服务器代理</p>
<h3 id="部署阶段">部署阶段</h3>
<p>vue根目录下建立两个配置文件：<code>.env.development</code>和<code>.env.production</code></p>
<pre tabindex="0"><code>//.env.development
VUE_APP_BASE_API=&#39;http://localhost:3000&#39;
VUE_APP_ENV=&#39;dev&#39;
</code></pre><pre tabindex="0"><code>//.env.production
VUE_APP_BASE_API=&#39;http://localhost:3000&#39;
VUE_APP_ENV=&#39;pro&#39;
</code></pre><p>在请求代码处，设置判定条件，若当前调试环境，则url=/home, 	若为打包环境，则url为全文</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> <span style="color:#a6e22e">api</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">null</span>;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> (<span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">VUE_APP_ENV</span> <span style="color:#f92672">===</span> <span style="color:#e6db74">&#39;dev&#39;</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">api</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;/home&#39;</span>
</span></span><span style="display:flex;"><span>} <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">api</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">process</span>.<span style="color:#a6e22e">env</span>.<span style="color:#a6e22e">VUE_APP_BASE_API</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">&#39;/home&#39;</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>最后，express要设置cors允许跨域</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">router</span>.<span style="color:#a6e22e">all</span>(<span style="color:#e6db74">&#39;*&#39;</span>, <span style="color:#66d9ef">function</span> (<span style="color:#a6e22e">req</span>, <span style="color:#a6e22e">res</span>, <span style="color:#a6e22e">next</span>) {
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Access-Control-Allow-Origin&#39;</span>, <span style="color:#e6db74">&#39;*&#39;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Access-Control-Allow-Headers&#39;</span>, <span style="color:#e6db74">&#39;Content-Type&#39;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Access-Control-Allow-Methods&#39;</span>, <span style="color:#e6db74">&#39;*&#39;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">res</span>.<span style="color:#a6e22e">header</span>(<span style="color:#e6db74">&#39;Content-Type&#39;</span>, <span style="color:#e6db74">&#39;application/json;charset=utf-8&#39;</span>);
</span></span><span style="display:flex;"><span>	<span style="color:#a6e22e">next</span>();
</span></span><span style="display:flex;"><span>});
</span></span></code></pre></div>
</div>


    </main>

    
      
    
  </body>
</html>
